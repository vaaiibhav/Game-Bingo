<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>print test</title>
</head>
<body>
<a href="javascript:sendPrintRequest(false)">print 58mm</a>
<a href="javascript:sendPrintRequest(true)">(preview)</a>
<a href="javascript:getPrintHistoryList()">(all history)</a>
<a href="javascript:getPrintHistory()">(get single history)</a>
<a href="javascript:setPrintHistory()">(set single history)</a>
<a href="javascript:clearPrintHistory()">(clear history)</a>
<div id="message"></div>
<script>
    var ipc = require('electron').ipcRenderer;
//    var p2 = require('electron').remote.require('../printer');
    function addLog(str) {
        document.getElementById('message').innerHTML += str + '<br>';
    }
    function getPrintHistoryList() {
        addLog(JSON.stringify(ipc.sendSync('print-get-list')));
    }
    function getPrintHistory() {
        addLog(JSON.stringify(ipc.sendSync('print-get', "7b4t7iZinGHP3Y5PQfnF1507702648265")));
    }
    function clearPrintHistory() {
        addLog(JSON.stringify(ipc.sendSync('print-clear')));
    }
    function setPrintHistory() {
        var oldData = ipc.sendSync('print-get', "7b4t7iZinGHP3Y5PQfnF1507702648265");
        oldData.extra = 2;
        addLog(JSON.stringify(ipc.sendSync('print-set', {id:"7b4t7iZinGHP3Y5PQfnF1507702648265",data:oldData})));
    }
    function sendPrintRequest(preview) {
        if(!preview)
        ipc.once('print-58m-reply', function (event, result) {
            alert(JSON.stringify(result));
        });
        /**
         * data: printing content
         * preview: bool，false=print，true=pop preview window
         * deviceName: string，default device name, check it at webContent.getPrinters()
         * timeoutPerLine: int，timeout，actual time is ：data.length * timeoutPerLine ms
         */
        ipc.send('print-58m', {
            data: [
                {type: 'bodyInit', css: {"margin": "0 0 0 0", "width": '167px'}},
                {
                    type: 'text',
                    value: '打印小票打印小票打印小票打印小票打印小票打印小票打印小票打印小票打印小票打印小票打印小票打印小票',
                    style: `text-align:center;`,
                    css: {"font-family": "Microsoft YaHei", "font-size": "12px"}
                },
                {type: 'text', value: '阿嘎达嘎的', style: `font-size: 16px`},
                {
                    type: 'barcode',
                    value: '20175754675467445555',
                    height: 12,
                    width: 1,
                    displayValue: true,
                    fontsize: 8,
                    style: ``
                },
                {
                    type: 'barcode',
                    value: '11156475467567449999',
                    height: 15,
                    width: 1,
                    displayValue: false,
                    fontsize: 12,
                    style: ``
                },
                {
                    type: 'text',
                    value: '11112222333344449999',
                    style: `text-align:center;font-size: 12px`,
                    css: {"font-family": "Microsoft YaHei"}
                },
                {
                    type: 'qrcode',
                    value: '11112222333344449999',
                    height: 64,
                    width: 64,
                    style: `text-align:center;width:64px;margin: 0 40px 0 40px`
                },
                {
                    type: 'qrcode',
                    value: '11112222333344449999',
                    height: 90,
                    width: 90,
                    style: `text-align:center;width:64px;margin: 0 40px 0 40px`
                },
                {type: 'text', value: '　', style: `text-align:center;font-size: 12px`},
            ],
            preview: preview,
            deviceName: 'XP-58C',
            timeoutPerLine: 400
        });
//        p2.print58m( {
//            data: [
//                {type: 'bodyInit', css: {"margin": "0 0 0 0", "width": '167px'}},
//                {
//                    type: 'text',
//                    value: '打印小票打印小票打印小票打印小票打印小票打印小票打印小票打印小票打印小票打印小票打印小票打印小票',
//                    style: `text-align:center;`,
//                    css: {"font-family": "Microsoft YaHei", "font-size": "12px"}
//                },
//                {type: 'text', value: '阿嘎达嘎的', style: `font-size: 16px`},
//                {
//                    type: 'barcode',
//                    value: '20175754675467445555',
//                    height: 12,
//                    width: 1,
//                    displayValue: true,
//                    fontsize: 8,
//                    style: ``
//                },
//                {
//                    type: 'barcode',
//                    value: '11156475467567449999',
//                    height: 15,
//                    width: 1,
//                    displayValue: false,
//                    fontsize: 12,
//                    style: ``
//                },
//                {
//                    type: 'text',
//                    value: '11112222333344449999',
//                    style: `text-align:center;font-size: 12px`,
//                    css: {"font-family": "Microsoft YaHei"}
//                },
//                {
//                    type: 'qrcode',
//                    value: '11112222333344449999',
//                    height: 64,
//                    width: 64,
//                    style: `text-align:center;width:64px;margin: 0 40px 0 40px`
//                },
//                {
//                    type: 'qrcode',
//                    value: '11112222333344449999',
//                    height: 90,
//                    width: 90,
//                    style: `text-align:center;width:64px;margin: 0 40px 0 40px`
//                },
//                {type: 'text', value: '　', style: `text-align:center;font-size: 12px`},
//            ],
//            preview: preview,
//            deviceName: 'XP-58C',
//            timeoutPerLine: 400
//        }).then((abc)=>{
//            alert(abc);
//        });
    }

</script>
</body>
</html>